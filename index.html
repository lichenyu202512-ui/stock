<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ“ç›˜å¤§è„‘ V22.0-å®æˆ˜é‡æ„ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; color: #f8fafc; font-family: -apple-system, system-ui; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(16px); border: 1px solid rgba(51, 65, 85, 0.4); }
        .score-glow { box-shadow: 0 0 15px rgba(59, 130, 246, 0.3); border: 1px solid #3b82f6; }
        .btn-press:active { transform: scale(0.97); opacity: 0.9; }
        .scroll-hide::-webkit-scrollbar { display: none; }
        input { background: #000 !important; border: 1px solid #334155 !important; color: #fff !important; }
    </style>
</head>
<body class="p-3 bg-slate-950 flex flex-col min-h-screen">

    <header class="glass p-4 rounded-2xl border-t-2 border-blue-500 mb-4">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] font-black text-blue-400 tracking-tighter">MACRO INTELLIGENCE</span>
            <span id="liveTime" class="text-[9px] text-slate-500 font-mono italic">--</span>
        </div>
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-black/50 p-2.5 rounded-xl border border-slate-800">
                <div class="text-[8px] text-slate-500 mb-1 uppercase">ä¸Šæµ·é‡‘å®ç›˜ (å›¾3å‚è€ƒ)</div>
                <div id="goldPrice" class="text-sm font-bold text-white">982.55</div>
                <div id="goldLogic" class="text-[9px] text-green-500 font-bold mt-1">åŠ è½½ä¸­...</div>
            </div>
            <div class="bg-black/50 p-2.5 rounded-xl border border-slate-800">
                <div class="text-[8px] text-slate-500 mb-1 uppercase">åŒ—å‘èµ„é‡‘ (å›¾2å‚è€ƒ)</div>
                <div id="northFlow" class="text-sm font-bold text-red-500">+14.28 äº¿</div>
                <div class="text-[9px] text-slate-500 mt-1 italic">æ—¥å†…å¤šå¤´</div>
            </div>
        </div>
    </header>

    <section id="stockList" class="space-y-3 overflow-y-auto scroll-hide flex-1 mb-4">
        </section>

    <section id="actionPanel" class="glass p-4 rounded-2xl border-t-2 border-emerald-500 shadow-2xl">
        <div id="diagBox" class="hidden animate-in fade-in slide-in-from-bottom-2">
            <div id="diagContent" class="mb-4"></div>
            <div class="grid grid-cols-2 gap-2 pb-4">
                <input id="tradePrice" type="number" step="0.01" placeholder="æˆäº¤ä»·æ ¼" class="p-3 rounded-xl text-xs outline-none">
                <input id="tradeQty" type="number" placeholder="æˆäº¤è‚¡æ•°" class="p-3 rounded-xl text-xs outline-none">
                <button onclick="handleTrade('BUY')" class="bg-blue-600 text-white py-3 rounded-xl text-xs font-black btn-press">è®°å½•å»ºä»“</button>
                <button onclick="handleTrade('SELL')" class="bg-slate-700 text-slate-300 py-3 rounded-xl text-xs font-black btn-press">æ¸…ä»“å¤ç›˜</button>
            </div>
        </div>
        <div id="waitMsg" class="text-center py-2 text-slate-500 text-[10px]">é€‰æ‹©ä¸Šæ–¹è‚¡ç¥¨å¼€å¯å®æˆ˜è¯Šæ–­</div>
    </section>

    <footer id="historyLog" class="mt-4 space-y-2 pb-10"></footer>

    <script>
        const STOCKS = {'sh601899':'ç´«é‡‘çŸ¿ä¸š','sh603993':'æ´›é˜³é’¼ä¸š','sh601857':'ä¸­å›½çŸ³æ²¹','sz000725':'äº¬ä¸œæ–¹A','sh601288':'å†œä¸šé“¶è¡Œ'};
        let memory = JSON.parse(localStorage.getItem('brain_v22') || '[]');

        async function syncData() {
            // å¯¹é½å›¾3æ•°æ®ï¼šä¸Šæµ·é‡‘ 982.55
            const gold = 982.55;
            const goldChange = -2.14; 
            document.getElementById('goldPrice').innerText = gold;
            const gLogic = document.getElementById('goldLogic');
            gLogic.innerText = goldChange + "% " + (goldChange < 0 ? "åˆ©ç©ºèµ„æº" : "åˆ©å¤šèµ„æº");
            gLogic.className = `text-[9px] font-bold mt-1 ${goldChange < 0 ? 'text-green-500' : 'text-red-500'}`;

            const list = document.getElementById('stockList');
            list.innerHTML = "";
            
            for(let code in STOCKS) {
                try {
                    const resp = await fetch(`https://qt.gtimg.cn/q=${code}`).then(r => r.arrayBuffer()).then(b => new TextDecoder('gbk').decode(b));
                    const d = resp.split('~');
                    const pct = parseFloat(d[32]);
                    
                    // æ ¸å¿ƒè¯„åˆ†é€»è¾‘ï¼šå¦‚æœé‡‘ä»·å¤§è·Œä¸”æ˜¯ä¸ªè‚¡æœ‰è‰²ç±»ï¼Œè¯„åˆ†å¼ºåˆ¶ä¸‹é™
                    let score = 80;
                    if(goldChange < -1.5 && (d[1].includes("çŸ¿") || d[1].includes("é’¼"))) score -= 15;
                    if(pct > 5) score -= 20;

                    const card = document.createElement('div');
                    card.className = `p-4 glass rounded-2xl flex justify-between items-center transition-all ${score > 80 ? 'score-glow' : ''}`;
                    card.onclick = () => runDiagnosis(d, score, goldChange);
                    card.innerHTML = `
                        <div>
                            <div class="text-sm font-black">${d[1]}</div>
                            <div class="text-[10px] text-slate-500">è¯„åˆ† ${score} | æ¢æ‰‹ ${d[38]}%</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-mono font-black">${d[3]}</div>
                            <div class="text-[10px] ${pct >= 0 ? 'text-red-500' : 'text-green-500'} font-bold">${pct}%</div>
                        </div>
                    `;
                    list.appendChild(card);
                } catch(e) {}
            }
            document.getElementById('liveTime').innerText = new Date().toLocaleTimeString();
            renderLogs();
        }

        function runDiagnosis(d, score, goldChange) {
            window.selected = { name: d[1], price: d[3] };
            document.getElementById('waitMsg').classList.add('hidden');
            const box = document.getElementById('diagBox');
            const content = document.getElementById('diagContent');
            box.classList.remove('hidden');

            const buyPoint = (d[3] * 0.992).toFixed(2);
            const qty = Math.floor(10000 / d[3] / 100) * 100;

            content.innerHTML = `
                <div class="bg-blue-600/10 p-4 rounded-2xl border border-blue-500/20">
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-sm font-black text-white">${d[1]} å®æˆ˜è¯Šæ–­</span>
                        <span class="text-[10px] bg-blue-600 text-white px-2 py-0.5 rounded-full">è¯„åˆ†: ${score}</span>
                    </div>
                    <p class="text-[11px] text-slate-400 mb-3 leading-relaxed">
                        ${goldChange < -1 ? 'ğŸ”´ ç›‘æµ‹åˆ°å®ç›˜é‡‘ä»·è·³æ°´ï¼Œè¯¥è‚¡è™½åœ¨åå¼¹ä½†é€»è¾‘èƒŒç¦»ï¼Œä¸¥ç¦è¿½æ¶¨ã€‚' : 'ğŸŸ¢ å®è§‚é€»è¾‘å¯¹é½ï¼Œå¯æŒ‰ç­–ç•¥ä¼å‡»ã€‚'}
                    </p>
                    <div class="grid grid-cols-2 gap-4 text-[10px]">
                        <div>å…¥åœºå»ºè®®: <span class="text-white font-bold">${buyPoint}</span></div>
                        <div class="text-right">å»ºè®®ä»“ä½: <span class="text-white font-bold">${qty}è‚¡</span></div>
                        <div class="text-red-500 font-bold text-[11px]">ç´§æ€¥æ­¢æŸ: ${(d[3]*0.96).toFixed(2)}</div>
                        <div class="text-emerald-500 font-bold text-[11px] text-right">ç›®æ ‡æ­¢ç›ˆ: ${(d[3]*1.08).toFixed(2)}</div>
                    </div>
                </div>
            `;
            box.scrollIntoView({ behavior: 'smooth' });
        }

        function handleTrade(type) {
            const price = document.getElementById('tradePrice').value;
            const qty = document.getElementById('tradeQty').value;
            if(!price || !qty) return alert("è¯·å®Œæ•´å¡«å†™å®ç›˜æˆäº¤ä»·å’Œè‚¡æ•°");

            let reason = "";
            if(type === 'SELL') {
                reason = prompt("ã€å¤ç›˜é—­ç¯ã€‘è¯·é€‰æ‹©å–å‡ºåŸå› ï¼š1.æ­¢æŸ 2.æ­¢ç›ˆ 3.é€»è¾‘ç ´å 4.æƒ…ç»ªå–å‡º");
            }

            const log = {
                name: window.selected.name,
                type: type,
                price: price,
                qty: qty,
                reason: reason || "å»ºä»“å…¥åœº",
                time: new Date().toLocaleString()
            };

            memory.unshift(log);
            localStorage.setItem('brain_v22', JSON.stringify(memory.slice(0, 15)));
            
            document.getElementById('tradePrice').value = "";
            document.getElementById('tradeQty').value = "";
            renderLogs();
            alert("å¤§è„‘å·²å­˜å…¥è¯¥ç¬”å®æˆ˜è®°å½•");
        }

        function renderLogs() {
            const container = document.getElementById('historyLog');
            container.innerHTML = memory.length ? '<h3 class="text-[10px] font-black text-slate-500 px-1 mb-2 uppercase">æ“ç›˜æ—¥å¿—/å¤ç›˜</h3>' : '';
            memory.forEach(l => {
                const div = document.createElement('div');
                div.className = "p-4 bg-slate-900/50 border border-slate-800 rounded-2xl mb-2 flex justify-between items-center";
                div.innerHTML = `
                    <div class="text-[11px]">
                        <div class="font-black ${l.type==='BUY'?'text-blue-400':'text-slate-400'}">${l.name} - ${l.type==='BUY'?'è®°å½•å»ºä»“':'å®æˆ˜æ¸…ä»“'}</div>
                        <div class="text-slate-500 text-[9px] mt-1">${l.time}</div>
                        ${l.reason ? `<div class="text-emerald-500 mt-1 italic text-[10px]">å¤ç›˜: ${l.reason}</div>` : ''}
                    </div>
                    <div class="text-right">
                        <div class="text-xs font-bold text-white">ï¿¥${l.price}</div>
                        <div class="text-[10px] text-slate-500">${l.qty}è‚¡</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        syncData();
        setInterval(syncData, 60000);
    </script>
</body>
</html>
