<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A股模型执行终端</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; -webkit-tap-highlight-color: transparent; }
        input { background: #1e293b !important; color: #fff !important; border: 1px solid #334155 !important; }
        .card { background: #0f172a; border: 1px solid #1e293b; border-radius: 1rem; }
    </style>
</head>
<body class="text-slate-200 p-4">
    <div class="max-w-md mx-auto space-y-4">
        <div class="card p-5 shadow-2xl">
            <h2 class="text-xs font-bold text-slate-500 mb-3 tracking-widest uppercase">Market Data / 实时行情</h2>
            <div class="flex gap-2 mb-4">
                <input id="code" type="text" placeholder="代码(如 sh600519)" class="flex-1 p-3 rounded-lg text-lg font-mono">
                <button onclick="getPrice()" class="bg-blue-600 px-6 rounded-lg font-bold active:scale-95 transition">查询</button>
            </div>
            <div class="flex justify-between items-end">
                <div id="price" class="text-4xl font-mono font-bold text-green-400">--.--</div>
                <div id="stockName" class="text-slate-400 text-sm mb-1">等待输入...</div>
            </div>
        </div>

        <div class="card p-5 border-t-2 border-t-red-500/50">
            <h2 class="text-xs font-bold text-slate-500 mb-3 tracking-widest uppercase">Risk Model / 2%风控模型</h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] text-slate-500 mb-1 block">买入价</label>
                    <input id="entry" type="number" step="0.01" class="w-full p-3 rounded-lg font-mono">
                </div>
                <div>
                    <label class="text-[10px] text-slate-500 mb-1 block">止损价</label>
                    <input id="stop" type="number" step="0.01" class="w-full p-3 rounded-lg font-mono text-red-400">
                </div>
            </div>
            <button onclick="calc()" class="w-full bg-red-600 mt-5 py-4 rounded-xl font-bold text-lg active:bg-red-700 shadow-lg">生成执行指令</button>
        </div>

        <div id="res" class="hidden card p-5 bg-blue-900/10 border-blue-500/30">
            </div>
    </div>

    <script>
        // 核心：获取行情逻辑
        function getPrice() {
            let code = document.getElementById('code').value.toLowerCase();
            if(!code) return;
            const script = document.createElement('script');
            script.src = `https://hq.sinajs.cn/list=${code}`;
            document.body.appendChild(script);
            script.onload = function() {
                const data = window['hq_str_' + code].split(',');
                if(data.length < 5) return alert('格式错误，例：sh600000 或 sz000001');
                document.getElementById('stockName').innerText = data[0];
                document.getElementById('price').innerText = data[3];
                document.getElementById('entry').value = data[3];
            }
        }

        // 核心：仓位计算逻辑
        function calc() {
            const entry = parseFloat(document.getElementById('entry').value);
            const stop = parseFloat(document.getElementById('stop').value);
            const total = 200000; // 这里可以改成你的实际资金
            
            if(entry <= stop) return alert('止损价必须低于买入价');
            
            const riskPerShare = entry - stop;
            const shares = Math.floor((total * 0.02) / riskPerShare / 100) * 100;
            const target = (entry + riskPerShare * 2).toFixed(2);

            const resDiv = document.getElementById('res');
            resDiv.classList.remove('hidden');
            resDiv.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between"><span>执行规模:</span><span class="text-xl font-bold text-white">${shares} 股</span></div>
                    <div class="flex justify-between text-sm text-slate-400"><span>名义市值:</span><span>¥${(shares * entry).toFixed(0)}</span></div>
                    <div class="border-t border-slate-800 my-2"></div>
                    <div class="flex justify-between text-green-400"><span>止盈目标(2R):</span><span class="font-bold">¥${target}</span></div>
                </div>
            `;
        }
    </script>
</body>
</html>
